<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="amor mío de mi vida">
    
    <title>
        
            红黑树 |
        
        Hesen's Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/avatar.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.xml"}
    KEEP.theme_config = {"title":"Keep","subtitle":"Hexo theme keep quick starter","description":"","keywords":null,"author":"Keep Team","language":"en","timezone":"","url":"http://example.com","permalink":":year/:month/:day/:name/","permalink_defaults":null,"pretty_urls":{"trailing_index":true,"trailing_html":true},"source_dir":"source","public_dir":"public","tag_dir":"tags","archive_dir":"archives","category_dir":"categories","code_dir":"downloads/code","i18n_dir":":lang","skip_render":null,"new_post_name":":title.md","default_layout":"post","titlecase":false,"external_link":{"enable":true,"field":"site","exclude":""},"filename_case":0,"render_drafts":false,"post_asset_folder":false,"relative_link":false,"future":true,"highlight":{"enable":true,"line_number":true,"auto_detect":false,"tab_replace":"","wrap":true,"hljs":false},"prismjs":{"enable":false,"preprocess":true,"line_number":true,"tab_replace":""},"index_generator":{"path":"","per_page":10,"order_by":"-date"},"default_category":"uncategorized","category_map":null,"tag_map":null,"meta_generator":true,"date_format":"YYYY-MM-DD","time_format":"HH:mm:ss","updated_option":"mtime","per_page":10,"pagination_dir":"page","include":null,"exclude":null,"ignore":null,"theme":"keep","deploy":{"type":""},"search":{"path":"search.json","field":"post","content":true,"format":"striptags"},"feed":{"type":"atom","path":"atom.xml","limit":20},"math":{"perpage":true,"mathjax":{"enable":true,"mhchem":false}},"root":"","base_info":{"primary_color":"#0066cc","title":"Hesen's Blog","author":"amor mío de mi vida","avatar":"/images/avatar.svg","logo":"/images/avatar.svg","favicon":"/images/avatar.svg"},"menu":{"home":"/                       || fa-solid fa-home","archives":"/archives           || fa-solid fa-box-archive","tags":"/tags                   || fa-solid fa-tags","categories":"/categories       || fa-solid fa-layer-group","about":"/about                 || fa-solid fa-user","github":"https://github.com/amor-mio-de-mi-vida || fa-brands fa-github"},"first_screen":{"enable":true,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Audentis fortuna iuvat.","hitokoto":false},"social_contact":{"enable":true,"links":{"github":"https://github.com/amor-mio-de-mi-vida","weixin":"img |","qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":true,"hide_header":true},"home":{"announcement":null,"category":true,"tag":true,"post_datetime":"updated"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":true,"min2read":true},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":true,"share":true,"reward":{"enable":false,"img_link":null,"text":null}},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":true,"site_pv":true,"page_pv":true}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":true},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":true},"footer":{"since":2020,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"source_data":{},"version":"4.2.3"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/avatar.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               Hesen's Blog
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                HOME
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                ARCHIVES
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/tags">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-tags"></i>
                                
                                TAGS
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/categories">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                
                                CATEGORIES
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/about">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-user"></i>
                                
                                ABOUT
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" target="_blank" rel="noopener" href="https://github.com/amor-mio-de-mi-vida">
                                
                                    <i class="menu-text-color menu-icon fa-brands fa-github"></i>
                                
                                GITHUB
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            HOME
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            ARCHIVES
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/tags">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i>
                                </span>
                            
                            TAGS
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/categories">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                </span>
                            
                            CATEGORIES
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/about">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-user"></i>
                                </span>
                            
                            ABOUT
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" target="_blank" rel="noopener" href="https://github.com/amor-mio-de-mi-vida">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-brands fa-github"></i>
                                </span>
                            
                            GITHUB
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        红黑树
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">amor mío de mi vida</span>
                                
                                    <span class="author-badge">Lv4</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2024-11-14 10:21:00</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Wed Nov 20 2024 09:18:27 GMT+0800">2024-11-20 09:18:27</span>
            </span>
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/oiwiki/">oiwiki</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/oiwiki/">oiwiki</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/RedBlackTree/">RedBlackTree</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>3.7k Words</span>
            </span>
        
        
            <span class="meta-info-item post-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>16 Mins</span>
            </span>
        
        
            <span class="meta-info-item post-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <p>红黑树是一种自平衡的二叉查找树，是一种高效的查找树。红黑树在业界应用很广泛，比如
Java 中的 TreeMap，JDK 1.8 中的 HashMap、C++ STL 中的 map
均是基于红黑树结构实现的。 <span id="more"></span> ## 红黑树的性质</p>
<p>红黑树是每个节点都带有颜色属性的二叉查找树，颜色为红色或黑色。在二叉查找树强制一般要求以外，对于任何有效的红黑树我们增加了如下的额外要求：</p>
<ul>
<li><p>性质1: 节点是红色或黑色</p></li>
<li><p>性质2: 根是黑色</p></li>
<li><p>性质3: 所有叶子都是黑色（叶子是NIL节点）</p></li>
<li><p>性质4:
每个红色节点必须有两个黑色的子节点。（或者说从每个叶子到根的所有路径上不能有两个连续的红色节点。）（或者说不存在两个相邻的红色节点，相邻指两个节点是父子关系。）（或者说红色节点的父节点和子节点均是黑色的。）</p></li>
<li><p>性质5: 从任一节点到其每个叶子的所有<a class="link" target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%81%93%E8%B7%AF_(%E5%9B%BE%E8%AE%BA)" title="道路 (图论)">简单路径<i class="fas fa-external-link-alt"></i></a>都包含相同数目的黑色节点。</p></li>
</ul>
<h2 id="红黑树的等价变换">红黑树的等价变换</h2>
<ul>
<li><p>红黑树和4阶B树 (2-3-4 树) 具有等价性</p></li>
<li><p>黑色节点与他的红色子节点融合在一起，形成1个B树节点</p></li>
<li><p>红黑树的黑色节点个数与4阶B树的节点总个数相等</p></li>
<li><p>在所有的B树节点中，永远是黑色节点是父节点，红色节点是子节点。黑色节点在中间，红色节点在两边。</p></li>
</ul>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/其他/image.esj7kixke.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<h2 id="红黑树的操作">红黑树的操作</h2>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Basic type definitions:</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">color_t</span> {BLACK, RED};</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RBnode</span> {        <span class="comment">// node of red-black tree</span></span><br><span class="line">	RBnode* parent;    <span class="comment">// == NIL if root of the tree</span></span><br><span class="line">	RBnode* child[<span class="number">2</span>];  <span class="comment">// == NIL if child is empty</span></span><br><span class="line">	<span class="comment">// The index is:</span></span><br><span class="line">	<span class="comment">//     LEFT := 0, if (key &lt; parent-&gt;key)</span></span><br><span class="line">	<span class="comment">//     RIGHT := 1, if (key &gt; parent-&gt;key)</span></span><br><span class="line">	<span class="keyword">enum</span> <span class="title class_">color_t</span> color;</span><br><span class="line">	<span class="type">int</span> key;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="meta">#definee NIL NULL <span class="comment">// null pointer or pointer to sentinel node</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LEFT 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RIGHT 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> left child[LEFT]</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> right child[RIGHT]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RBtree</span> {   <span class="comment">// red-black tree </span></span><br><span class="line">	RBnode* root; <span class="comment">// == NIL if tree is empty</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get the child direction of the non-root non-NIL RBnode* N:</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> childDir(N) (N == (N-&gt;parent)-&gt;right? RIGHT: LEFT)</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="旋转操作">旋转操作</h3>
<p>左旋是将某个节点旋转为其右孩子的左孩子，而右旋是节点旋转为其左孩子的右孩子。</p>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/其他/image.4uaydgivfo.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">RBnode* <span class="title">RotateDirRoot</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	RBtree* T,   <span class="comment">// red-black tree</span></span></span></span><br><span class="line"><span class="params"><span class="function">	RBnode*P,    <span class="comment">// root of subtree (may be the root of T)</span></span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">int</span> dir)</span> </span>{   <span class="comment">// direction</span></span><br><span class="line">	RBnode* G = P-&gt;parent;</span><br><span class="line">	RBnode* S = P-&gt;child[<span class="number">1</span>-dir];</span><br><span class="line">	RBnode* C;</span><br><span class="line">	<span class="built_in">assert</span>(S != NIL); <span class="comment">// pointer to true node required</span></span><br><span class="line">	C = S-&gt;child[dir];</span><br><span class="line">	P-&gt;child[<span class="number">1</span>-dir] = C; <span class="keyword">if</span> (C != NIL) C-&gt;parent = P;</span><br><span class="line">	S-&gt;child[dir] = P; P-&gt;parent = S;</span><br><span class="line">	S-&gt;parent = G;</span><br><span class="line">	<span class="keyword">if</span> (G != <span class="literal">NULL</span>)</span><br><span class="line">		G-&gt;child[P == G-&gt;right? RIGHT : LEFT] = S;</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		T-&gt;root = S;</span><br><span class="line">	<span class="keyword">return</span> S; <span class="comment">// new root of subtree</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RotateDir(N, dir) RotateDirRoot(T, N, dir)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RotateLeft(N) RotateDirRoot(T,N,LEFT)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RotateRight(N) RotateDirRoot(T,N,RIGHT)</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="插入操作">插入操作</h3>
<p>我们首先<a class="link" target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91#%E6%8F%92%E5%85%A5" title="二叉查找树">以二叉查找树的方法<i class="fas fa-external-link-alt"></i></a>增加节点并标记它为红色。（如果设为黑色，就会导致根到叶子的路径上有一条路上，多一个额外的黑节点，这个是很难调整的。但是设为红色节点后，可能会导致出现两个连续红色节点的冲突，那么可以通过颜色调换（color
flips）和树旋转来调整。）下面要进行什么操作取决于其他临近节点的颜色。同人类的家族树中一样，我们将使用术语_叔父节点_来指一个节点的父节点的兄弟节点。注意：</p>
<ul>
<li><p>性质1和性质3总是保持着</p></li>
<li><p>性质4只在增加红色节点、重绘黑色节点为红色，或做旋转时受到威胁</p></li>
<li><p>性质5只在增加黑色节点、重绘红色节点为黑色，或做旋转时受到威胁</p></li>
</ul>
<p>对于每种情形，通过下列函数，可以找到一个节点的<code>uncle</code>节点和<code>grand</code>节点。</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">RBinsert1</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	RBtree* T,           <span class="comment">// -&gt; red-black tree</span></span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="keyword">struct</span> RBnode* N,    <span class="comment">// -&gt; node to be inserted</span></span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="keyword">struct</span> RBnode* P,    <span class="comment">// -&gt; parent node of N (may be NULL)</span></span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="type">int</span> dir)</span> </span>{           <span class="comment">// side (LEFT or RIGHT) of P where to insert N</span></span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">RBnode</span>* G;    <span class="comment">// -&gt; parent node of P</span></span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">RBnode</span>* U;    <span class="comment">// -&gt; uncle of N</span></span><br><span class="line"></span><br><span class="line">	N-&gt;color = RED;</span><br><span class="line">	N-&gt;left = NIL;</span><br><span class="line">	N-&gt;right = NIL;</span><br><span class="line">	N-&gt;parent = P; </span><br><span class="line">	<span class="keyword">if</span> (P == <span class="literal">NULL</span>) {     <span class="comment">// There is no parent </span></span><br><span class="line">		T-&gt;root = N;     <span class="comment">// N is the new root of the tree T.</span></span><br><span class="line">		<span class="keyword">return</span>;          <span class="comment">// insertion complete</span></span><br><span class="line">	}</span><br><span class="line">	P-&gt;child[dir] = N;   <span class="comment">// insert N as dir-child of P</span></span><br><span class="line">	<span class="comment">// start of the (do while) loop;</span></span><br><span class="line">	<span class="keyword">do</span> {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><strong>Case1: The current node’s parent&nbsp;P&nbsp;is black</strong>, so&nbsp;<a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#req3">requirement
3<i class="fas fa-external-link-alt"></i></a>&nbsp;holds. Requirement 4 holds also according to the&nbsp;<a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#loopInvariantI">loop
invariant<i class="fas fa-external-link-alt"></i></a>. </p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (P-&gt;color == BLACK) {</span><br><span class="line">	<span class="comment">// Case_I1 (P black):</span></span><br><span class="line">	<span class="keyword">return</span>; <span class="comment">// insertion complete</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// From now on P is red.</span></span><br><span class="line"><span class="keyword">if</span> ((G = P-&gt;parent) == <span class="literal">NULL</span>)</span><br><span class="line">	<span class="keyword">goto</span> Case_I4;      <span class="comment">// P red and root</span></span><br><span class="line">dir = <span class="built_in">childDir</span>(P);     <span class="comment">// the side of parent G on which node P is located</span></span><br><span class="line">U = G-&gt;child[<span class="number">1</span>-dir];   <span class="comment">// uncle</span></span><br><span class="line"><span class="keyword">if</span> (U == NIL || U-&gt;color == BLACK) <span class="comment">// considered black</span></span><br><span class="line">	<span class="keyword">goto</span> Case_I56;     <span class="comment">// P red &amp;&amp; U black</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p><strong>Case2:If both the parent&nbsp;P&nbsp;and the uncle&nbsp;U&nbsp;are red</strong>,
then both of them can be repainted black and the
grandparent&nbsp;<strong>G</strong>&nbsp;becomes red for maintaining&nbsp;<a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#req4">requirement
4<i class="fas fa-external-link-alt"></i></a>. Since any path through the parent or uncle must pass through the
grandparent, the number of black nodes on these paths has not changed.
However, the grandparent&nbsp;<strong>G</strong>&nbsp;may now violate requirement
3, if it has a red parent. After
relabeling&nbsp;<strong>G</strong>&nbsp;to&nbsp;<strong>N</strong>&nbsp;the&nbsp;<a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#loopInvariantI">loop
invariant<i class="fas fa-external-link-alt"></i></a>&nbsp;is fulfilled so that the rebalancing can be iterated on
one black level (= 2 tree levels) higher.</p>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/其他/image.pfd1dbt4v.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Case_I2 (P+U red):</span></span><br><span class="line">P-&gt;color = BLACK;</span><br><span class="line">U-&gt;color = BLACK;</span><br><span class="line">G-&gt;color = RED;</span><br><span class="line">N = G;       <span class="comment">//new current node</span></span><br><span class="line"><span class="comment">// iterate 1 black level higher (= 2 tree levels)</span></span><br><span class="line">} <span class="keyword">while</span> ((P = N-&gt;parent) != <span class="literal">NULL</span>);</span><br><span class="line"><span class="comment">// end of the (do while)-loop.</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>Case3</strong>: <a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#Insert_case_I2">Insert
case I2<i class="fas fa-external-link-alt"></i></a>&nbsp;has been executed for&nbsp;<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.781ex;" xmlns="http://www.w3.org/2000/svg" width="3.961ex" height="2.791ex" role="img" focusable="false" viewBox="0 -888.7 1751 1233.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,398) scale(0.707)"><g data-mml-node="mi"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(576,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(1354,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mn" transform="translate(698.7,-345) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><rect width="1511" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></span> times and the total height
of the tree has increased by 1, now being&nbsp;<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.303ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 576 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container></span>&nbsp;The current node&nbsp;<strong>N</strong>&nbsp;is
the (red) root of the tree, and all RB-properties are satisfied.</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Leaving the (do while)-loop (after having fallen through from Case_I2).</span></span><br><span class="line"><span class="comment">// Case_I3: N is the root and red.</span></span><br><span class="line"><span class="keyword">return</span>; <span class="comment">//insertion complete.</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>Case4</strong>：The parent&nbsp;<strong>P</strong>&nbsp;is red and the
root. Because&nbsp;<strong>N</strong>&nbsp;is also red, requirement 3 is violated.
But after switching&nbsp;<strong>P</strong>’s color the tree is in RB-shape.
The black height of the tree increases by 1.</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Case_I4:      <span class="comment">// P is the root and red:</span></span><br><span class="line">	P-&gt;color = BLACK;</span><br><span class="line">	<span class="keyword">return</span>;   <span class="comment">// insertion complete</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>Case5</strong>：The parent&nbsp;<strong>P</strong>&nbsp;is red but the
uncle&nbsp;<strong>U</strong>&nbsp;is black. The ultimate goal is to rotate the
parent node&nbsp;<strong>P</strong>&nbsp;to the grandparent position, but this
will not work if&nbsp;<strong>N</strong>&nbsp;is an "inner" grandchild
of&nbsp;<strong>G</strong>&nbsp;(i.e., if&nbsp;<strong>N</strong>&nbsp;is the left child of
the right child of&nbsp;<strong>G</strong>&nbsp;or the right child of the left
child of&nbsp;<strong>G</strong>).
A&nbsp;<code>dir</code>-rotation&nbsp;at&nbsp;<strong>P</strong>&nbsp;switches the roles of
the current node&nbsp;<strong>N</strong>&nbsp;and its parent&nbsp;<strong>P</strong>.
The rotation adds paths through&nbsp;<strong>N</strong>&nbsp;(those in the subtree
labeled&nbsp;<strong>2</strong>, see diagram) and removes paths
through&nbsp;<strong>P</strong>&nbsp;(those in the subtree
labeled&nbsp;<strong>4</strong>). But
both&nbsp;<strong>P</strong>&nbsp;and&nbsp;<strong>N</strong>&nbsp;are red, so&nbsp;<a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#req4">requirement
4<i class="fas fa-external-link-alt"></i></a>&nbsp;is preserved. Requirement 3 is restored in case 6.</p>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/其他/image.2yydkuzenb.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Case_I56:     <span class="comment">// P red &amp;&amp; U black:</span></span><br><span class="line">	<span class="keyword">if</span> (N == P-&gt;child[<span class="number">1</span>-dir]) {</span><br><span class="line">		<span class="comment">// Case_I5 (P red &amp;&amp; U black &amp;&amp; N inner grandchild of G)</span></span><br><span class="line">		<span class="built_in">RotateDir</span>(P, dir);    <span class="comment">// P is never the root</span></span><br><span class="line">		N = P;   <span class="comment">// new current node</span></span><br><span class="line">		P = G-&gt;child[dir];    <span class="comment">// new parent of N</span></span><br><span class="line">		<span class="comment">// fall through to Case_I6</span></span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure>
<p><strong>Case6</strong>: The current node&nbsp;<strong>N</strong>&nbsp;is now
certain to be an "outer" grandchild of&nbsp;<strong>G</strong>(left of left
child or right of right child).
Now&nbsp;<code>(1-dir)</code>-rotate&nbsp;at&nbsp;<strong>G</strong>,
putting&nbsp;<strong>P</strong>&nbsp;in place of&nbsp;<strong>G</strong>&nbsp;and
making&nbsp;<strong>P</strong>&nbsp;the parent
of&nbsp;<strong>N</strong>&nbsp;and&nbsp;<strong>G</strong>.&nbsp;<strong>G</strong>&nbsp;is
black and its former child&nbsp;<strong>P</strong>&nbsp;is red, since&nbsp;<a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#req3">requirement
3<i class="fas fa-external-link-alt"></i></a>&nbsp;was violated. After switching the colors
of&nbsp;<strong>P</strong>&nbsp;and&nbsp;<strong>G</strong>&nbsp;the resulting tree
satisfies requirement 3.&nbsp;<a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#req4">Requirement
4<i class="fas fa-external-link-alt"></i></a>&nbsp;also remains satisfied, since all paths that went through the
black&nbsp;<strong>G</strong>&nbsp;now go through the
black&nbsp;<strong>P</strong>.</p>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/其他/image.9dczggl9f9.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Case_I6 (P red &amp;&amp; U black &amp;&amp; N outer grandchild of G)</span></span><br><span class="line">	<span class="built_in">RotateDirRoot</span>(T, G, <span class="number">1</span>-dir);  <span class="comment">// G may be the root</span></span><br><span class="line">	P-&gt;color = BLACK;</span><br><span class="line">	G-&gt;color = RED;</span><br><span class="line">	<span class="keyword">return</span>  <span class="comment">// insertion complete</span></span><br><span class="line">} <span class="comment">// end of RBinsert1</span></span><br></pre></td></tr></tbody></table></figure>
<p>Because the algorithm transforms the input without using an auxiliary
data structure and using only a small amount of extra storage space for
auxiliary variables it is&nbsp;<a class="link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/In-place_algorithm" title="In-place algorithm">in-place<i class="fas fa-external-link-alt"></i></a>.</p>
<h3 id="删除操作">删除操作</h3>
<p><strong>如果需要删除的节点有两个儿子，那么问题可以被转化成删除另一个只有一个儿子的节点的问题</strong>（为了表述方便，这里所指的儿子，为非叶子节点的儿子）。对于二叉查找树，在删除带有两个非叶子儿子的节点的时候，我们要么找到它左子树中的最大元素、要么找到它右子树中的最小元素，并把它的值转移到要删除的节点中（如在<a class="link" target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91" title="二叉查找树">这里<i class="fas fa-external-link-alt"></i></a>所展示的那样）。我们接着删除我们从中复制出值的那个节点，它必定有少于两个非叶子的儿子。因为只是复制了一个值（没有复制颜色），不违反任何性质，这就把问题简化为如何删除最多有一个儿子的节点的问题。它不关心这个节点是最初要删除的节点还是我们从中复制出值的那个节点。</p>
<p>在本文余下的部分中，<strong>我们只需要讨论删除只有一个儿子的节点</strong>（如果它两个儿子都为空，即均为叶子，我们任意将其中一个看作它的儿子）。如果我们删除一个红色节点（此时该节点的儿子将都为叶子节点），它的父亲和儿子一定是黑色的。所以我们可以简单的用它的黑色儿子替换它，并不会破坏性质3和性质4。通过被删除节点的所有路径只是少了一个红色节点，这样可以继续保证性质5。另一种简单情况是在被删除节点是黑色而它的儿子是红色的时候。如果只是去除这个黑色节点，用它的红色儿子顶替上来的话，会破坏性质5，但是如果我们重绘它的儿子为黑色，则曾经通过它的所有路径将通过它的黑色儿子，这样可以继续保持性质5。</p>
<p><strong>需要进一步讨论的是在要删除的节点和它的儿子二者都是黑色的时候</strong>，这是一种复杂的情况（这种情况下该节点的两个儿子都是叶子节点，否则若其中一个儿子是黑色非叶子节点，另一个儿子是叶子节点，那么从该节点通过非叶子节点儿子的路径上的黑色节点数最小为2，而从该节点到另一个叶子节点儿子的路径上的黑色节点数为1，违反了性质5）。我们首先把要删除的节点替换为它的儿子。出于方便，称呼这个儿子为<strong>N</strong>（在新的位置上），称呼它的兄弟（它父亲的另一个儿子）为<strong>S</strong>。在下面的示意图中，我们还是使用<strong>P</strong>称呼N的父亲，<strong>SL</strong>称呼S的左儿子，<strong>SR</strong>称呼S的右儿子。我们将使用下述函数找到兄弟节点：</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">RBdelete2</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	RBtree* T,             <span class="comment">// -&gt; red-black tree</span></span></span></span><br><span class="line"><span class="params"><span class="function">	<span class="keyword">struct</span> RBnode* N)</span> </span>{    <span class="comment">// -&gt; node to be deleted</span></span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">RBnode</span>* P = N-&gt;parent     <span class="comment">// -&gt; parent node of N</span></span><br><span class="line">	byte dir;             <span class="comment">// side of P on which N is located</span></span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">RBnode</span>* S;     <span class="comment">// -&gt; sibling of N</span></span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">RBnode</span>* C;     <span class="comment">// -&gt; close nephew</span></span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">RBnode</span>* D;     <span class="comment">// -&gt;distant nephew</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// P != NULL, since N is not the root.</span></span><br><span class="line">	dir = <span class="built_in">childDir</span>(N);    <span class="comment">// side of parent P on which the node N is located</span></span><br><span class="line">	<span class="comment">// Replace N at its parent P by NIL;</span></span><br><span class="line">	P-&gt;child[dir] = NIL;</span><br><span class="line">	<span class="keyword">goto</span> Start_D;         <span class="comment">// jump into the loop</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// start of the (do while)-loop:</span></span><br><span class="line">	<span class="keyword">do</span> {</span><br><span class="line">		dir = <span class="built_in">childDir</span>(N);    <span class="comment">// side of parent P on which node N is lodated</span></span><br><span class="line">Start_D:</span><br><span class="line">		S = P-&gt;child[<span class="number">1</span>-dir];  <span class="comment">// sibling of N (has black hight &gt;= 1)</span></span><br><span class="line">		D = S-&gt;child[<span class="number">1</span>-dir];  <span class="comment">// distant nephew</span></span><br><span class="line">		C = S-&gt;child[dir];    <span class="comment">// close nephew</span></span><br><span class="line">		<span class="keyword">if</span> (S-&gt;color = RED) </span><br><span class="line">			<span class="keyword">goto</span> Case_D3;     <span class="comment">// S red ====&gt; P+C+D black</span></span><br><span class="line">		</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>我们可以使用下列代码进行上述的概要步骤，这里的函数<code>replace_node</code>替换<code>child</code>到<code>n</code>在树中的位置。出于方便，在本章节中的代码将假定空叶子被用不是NULL的实际节点对象来表示。</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">delete_one_child</span><span class="params">(<span class="keyword">struct</span> node* n)</span> </span>{</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Precondition: n has at most one non-null child.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">node</span>* child = <span class="built_in">is_leaf</span>(n-&gt;right) ? n-&gt;left : n-&gt;right;</span><br><span class="line">	<span class="built_in">replace_node</span>(n, child);</span><br><span class="line">	<span class="keyword">if</span> (n-&gt;color == BLACK) {</span><br><span class="line">		<span class="keyword">if</span> (child-&gt;color = RED)</span><br><span class="line">			child-&gt;color = BLACK;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="built_in">delete_case1</span>(child);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">free</span>(n);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>如果N和它初始的父亲是黑色，则删除它的父亲导致通过N的路径都比不通过它的路径少了一个黑色节点。因为这违反了性质5，树需要被重新平衡。有几种情形需要考虑：</p>
<p><strong>Case1:</strong>&nbsp;N是新的根。在这种情形下，我们就做完了。我们从所有路径去除了一个黑色节点，而新根是黑色的，所以性质都保持着。</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">delete_case1</span><span class="params">(<span class="keyword">struct</span> node* n)</span> </span>{</span><br><span class="line">	<span class="keyword">if</span>(n-&gt;parent != <span class="literal">NULL</span>) </span><br><span class="line">		<span class="built_in">delete_case2</span>(n);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><strong>注意</strong>：在情形2、5和6下，我们假定N是它父亲的左儿子。如果它是右儿子，则在这些情形下的_左_和_右_应当对调。</p>
<p><strong>情形2：</strong>&nbsp;S是红色。在这种情形下我们在N的父亲上做<a class="link" target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%A0%91%E6%97%8B%E8%BD%AC" title="树旋转">左旋转<i class="fas fa-external-link-alt"></i></a>，把红色兄弟转换成N的祖父，我们接着对调N的父亲和祖父的颜色。完成这两个操作后，尽管所有路径上黑色节点的数目没有改变，但现在N有了一个黑色的兄弟和一个红色的父亲（它的新兄弟是黑色因为它是红色S的一个儿子），所以我们可以接下去按<strong>情形4</strong>、<strong>情形5</strong>或<strong>情形6</strong>来处理。</p>
<p>（注意：这里的图中没有显示出来，N是删除了黑色节点后替换上来的子节点，所以这个过程中由P-&gt;X-&gt;N变成了P-&gt;N，实际上是少了一个黑色节点，也可以理解为Parent(Black)和Silbing(Red)那么他们的孩子黑色节点的数目肯定不等，让他们做新兄弟肯定是不平衡的，还需后面继续处理。</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> delet</span><br></pre></td></tr></tbody></table></figure>
<h3 id="红黑树的平衡">红黑树的平衡</h3>
<p>AVL是靠平衡因子来保持平衡的，比如平衡因子为1，那么左右子树的高度差就不能超过1，是一种强平衡。</p>
<p>对于红黑树而言，为何那5条性质，就能保证红黑树是平衡的？因为那5条性质，可以保证红黑树等价于4阶B树。B树比较矮，它本身就是平衡的，高度越小越平衡。</p>
<p>红黑树就是能保证这个树高度不会特别高，红黑树的最大高度是 2 ∗ log2(n +
1) ，依然是 O(logn)
级别，因为高度不会很大进而维持一种相对平衡的状态。相比AVL树，红黑树的平衡标准比较宽松：<mark>没有一条路径会大于其他路径的2倍</mark>。这是是一种弱平衡、黑高度平衡（黑高度只算黑色节点个数，红黑树的任何一条路径的黑色节点数一样，则黑高度都是一样）。</p>
<ul>
<li><p>搜索的次数远远大于插入和删除，选择AVL树；搜索、插入、删除次数几乎差不多，选择红黑树</p></li>
<li><p>相对于AVL树来说，红黑树牺牲了部分平衡性以换取插入/删除操作时少量的旋转操作，整体来说性能要优于AVL树</p></li>
<li><p>红黑树的平均统计性能优于AVL树，实际应用中更多选择使用红黑树</p></li>
</ul>

                    
                </div>

                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                红黑树
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                2024/11/14/others-oi-wiki-红黑树/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    Author
                </div>
                <div class="content">amor mío de mi vida</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    Published
                </div>
                <div class="content">2024-11-14 10:21</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    License
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="Copy copyright info" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/oiwiki/">oiwiki</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/RedBlackTree/">RedBlackTree</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip" data-tooltip-content="Share to QQ">
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img" data-tooltip-content="Share to WeChat" data-tooltip-img-tip="Scan by WeChat" data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;">
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip" data-tooltip-content="Share to WeiBo">
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev" rel="prev" href="/2024/11/16/course-CS267-9-Distributed-Memory-Machines-and-Programming/" title="Distributed Memory Machines and Programming">
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">Distributed Memory Machines and Programming</span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next" rel="next" href="/2024/11/13/course-CS267-8-Data-Parallel-Algorithms/" title="Data Parallel Algorithms">
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">Data Parallel Algorithms</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E7%AD%89%E4%BB%B7%E5%8F%98%E6%8D%A2"><span class="nav-text">红黑树的等价变换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-text">红黑树的操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%8B%E8%BD%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">旋转操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C"><span class="nav-text">插入操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C"><span class="nav-text">删除操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E5%B9%B3%E8%A1%A1"><span class="nav-text">红黑树的平衡</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
        ©&nbsp;<span>2020</span>&nbsp;-&nbsp;2024
        
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">amor mío de mi vida</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&amp;&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    
        <div class="count-info info-item">
            

            
                <span class="count-item border-box uv">
                    <span class="item-type border-box">Unique Visitor</span>
                    <span class="item-value border-box uv" id="busuanzi_value_site_uv"></span>
                </span>
            

            
                <span class="count-item border-box pv">
                    <span class="item-type border-box">Page View</span>
                    <span class="item-value border-box pv" id="busuanzi_value_site_pv"></span>
                </span>
            
        </div>
    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E7%AD%89%E4%BB%B7%E5%8F%98%E6%8D%A2"><span class="nav-text">红黑树的等价变换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-text">红黑树的操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%8B%E8%BD%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">旋转操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C"><span class="nav-text">插入操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C"><span class="nav-text">删除操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E5%B9%B3%E8%A1%A1"><span class="nav-text">红黑树的平衡</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local search -->

    
<script src="/js/local-search.js"></script>



<!-- lazyload -->

    
<script src="/js/lazyload.js"></script>



<div class="pjax">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        
            
<script src="/js/post/toc.js"></script>

        

        <!-- copyright-info -->
        
            
<script src="/js/post/copyright-info.js"></script>

        

        <!-- share -->
        
            
<script src="/js/post/share.js"></script>

        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->

    
<script src="//cdn.jsdelivr.net/npm/mermaid@10.5.0/dist/mermaid.min.js"></script>

    <script data-pjax="">
      if (window.mermaid) {
        mermaid.init()
      }
    </script>






<!-- pjax -->

    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart()
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd()
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'))
            KEEP.initExecute()
        });
    });
</script>






<script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>