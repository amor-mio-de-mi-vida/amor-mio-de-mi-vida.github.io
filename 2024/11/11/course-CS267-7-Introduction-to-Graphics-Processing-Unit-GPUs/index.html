<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="amor mío de mi vida">
    
    <title>
        
            Introduction to Graphics Processing Unit (GPUs) |
        
        Hesen's Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/avatar.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.xml"}
    KEEP.theme_config = {"title":"Keep","subtitle":"Hexo theme keep quick starter","description":"","keywords":null,"author":"Keep Team","language":"en","timezone":"","url":"http://example.com","permalink":":year/:month/:day/:name/","permalink_defaults":null,"pretty_urls":{"trailing_index":true,"trailing_html":true},"source_dir":"source","public_dir":"public","tag_dir":"tags","archive_dir":"archives","category_dir":"categories","code_dir":"downloads/code","i18n_dir":":lang","skip_render":null,"new_post_name":":title.md","default_layout":"post","titlecase":false,"external_link":{"enable":true,"field":"site","exclude":""},"filename_case":0,"render_drafts":false,"post_asset_folder":false,"relative_link":false,"future":true,"highlight":{"enable":true,"line_number":true,"auto_detect":false,"tab_replace":"","wrap":true,"hljs":false},"prismjs":{"enable":false,"preprocess":true,"line_number":true,"tab_replace":""},"index_generator":{"path":"","per_page":10,"order_by":"-date"},"default_category":"uncategorized","category_map":null,"tag_map":null,"meta_generator":true,"date_format":"YYYY-MM-DD","time_format":"HH:mm:ss","updated_option":"mtime","per_page":10,"pagination_dir":"page","include":null,"exclude":null,"ignore":null,"theme":"keep","deploy":{"type":""},"search":{"path":"search.json","field":"post","content":true,"format":"striptags"},"feed":{"type":"atom","path":"atom.xml","limit":20},"math":{"perpage":true,"mathjax":{"enable":true,"mhchem":false}},"root":"","base_info":{"primary_color":"#0066cc","title":"Hesen's Blog","author":"amor mío de mi vida","avatar":"/images/avatar.svg","logo":"/images/avatar.svg","favicon":"/images/avatar.svg"},"menu":{"home":"/                       || fa-solid fa-home","archives":"/archives           || fa-solid fa-box-archive","tags":"/tags                   || fa-solid fa-tags","categories":"/categories       || fa-solid fa-layer-group","about":"/about                 || fa-solid fa-user","github":"https://github.com/amor-mio-de-mi-vida || fa-brands fa-github"},"first_screen":{"enable":true,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Audentis fortuna iuvat.","hitokoto":false},"social_contact":{"enable":true,"links":{"github":"https://github.com/amor-mio-de-mi-vida","weixin":"img |","qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":true,"hide_header":true},"home":{"announcement":null,"category":true,"tag":true,"post_datetime":"updated"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":true,"min2read":true},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":true,"share":true,"reward":{"enable":false,"img_link":null,"text":null}},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":true,"site_pv":true,"page_pv":true}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":true},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":true},"footer":{"since":2020,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"source_data":{},"version":"4.2.3"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/avatar.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               Hesen's Blog
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                HOME
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                ARCHIVES
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/tags">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-tags"></i>
                                
                                TAGS
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/categories">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                
                                CATEGORIES
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/about">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-user"></i>
                                
                                ABOUT
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" target="_blank" rel="noopener" href="https://github.com/amor-mio-de-mi-vida">
                                
                                    <i class="menu-text-color menu-icon fa-brands fa-github"></i>
                                
                                GITHUB
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            HOME
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            ARCHIVES
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/tags">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i>
                                </span>
                            
                            TAGS
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/categories">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                </span>
                            
                            CATEGORIES
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/about">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-user"></i>
                                </span>
                            
                            ABOUT
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" target="_blank" rel="noopener" href="https://github.com/amor-mio-de-mi-vida">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-brands fa-github"></i>
                                </span>
                            
                            GITHUB
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        Introduction to Graphics Processing Unit (GPUs)
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">amor mío de mi vida</span>
                                
                                    <span class="author-badge">Lv4</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2024-11-11 13:33:44</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Mon Nov 11 2024 16:24:32 GMT+0800">2024-11-11 16:24:32</span>
            </span>
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/cs267/">cs267</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/course/">course</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>1.4k Words</span>
            </span>
        
        
            <span class="meta-info-item post-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>8 Mins</span>
            </span>
        
        
            <span class="meta-info-item post-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h2 id="summary">Summary</h2>
<p>GPUs gain efficiency from simpler cores and more parallelism</p>
<ul>
<li>Very wide SIMD (SIMT) for parallel arithmetic and
latency-hiding</li>
</ul>
<p>Heterogeneous programming with manual offload</p>
<ul>
<li>CPU to run OS, etc. GPU for compute</li>
</ul>
<p>Massive (mostly data) parallelism required</p>
<ul>
<li>Not as strict as CPU-SIM (divergent addresses, instructions)</li>
</ul>
<p>Threads in block share faster memory and barriers</p>
<ul>
<li>Blocks in kernel share slow device memory and atomics
<span id="more"></span></li>
</ul>
<h2 id="gpu">GPU</h2>
<h3 id="what-is-a-gpu">What is a GPU?</h3>
<div class="keep-note primary"><p><strong>Hardware Big Idea #1:</strong></p>
<p>Remove components that help a single instruction stream run fast.</p>
<ul>
<li><p>Discover parallelism</p></li>
<li><p>Consume energy</p></li>
</ul>
</div>
<div class="keep-note primary"><p><strong>Hardware Idea #2:</strong></p>
<p>A larger number of (smaller simpler) cores. With this much
parallelism, it's likely to be <em>data parallel</em> (same operation,
different data)</p>
</div>
<div class="keep-note primary"><p><strong>Hardware Big Idea #3:</strong></p>
<p>Share the instruction stream</p>
</div>
<p>NVIDIA will call this a <code>warp</code> of threads, or
<code>SIMT</code>: single instruction multiple threads.</p>
<p>The way they differentiate it from <code>SIMD</code> is in two
ways.</p>
<ul>
<li><p><code>SIMD</code> is usually a continuous vector, that you're
operating on, and <code>SIMT</code> can be anywhere, just needs to be
the same instruction. The data doesn't need to be living in the same
location (memory coalescing)</p></li>
<li><p>In <code>SIMT</code>, threads are alive continuously, whereas in
the <code>SIMD</code> instruction, the default is to do scalar
operations, and sometimes you go into the regime of doing vector
operations.</p></li>
</ul>
<h3 id="what-about-branches">What about Branches?</h3>
<p>If you write your code without paying attention to this reality that
threads within a so-called wrap, will be basically serialize the
branches, then you can go into a place where only one thread is active
within the nested if statements.</p>
<div class="keep-note primary"><p><strong>Hardware Idea #4:</strong></p>
<p>Masks</p>
</div>
<blockquote>
<p>warp is the NVIDIAs concept of threads that execute the same
instruction in one cycle. And if there's divergence, they're just gonna
wait for both cases to execute.</p>
</blockquote>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/CS-267/image.231w0o7w9v.png">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<h3 id="stalls">Stalls</h3>
<ul>
<li><p>Stalls: a core cannot run the next instruction because of a
dependency on a previous one.</p></li>
<li><p>Memory operations are 100s-1000s of cycles.</p></li>
<li><p>Removed the fancy caches and prefetch logic that helps avoid
stalls.</p></li>
</ul>
<p>CPU have the fancy caches and prefetch logic, but GPUs don't care
about the latency of this operation, but GPUs care about throughput,
which means GPUs only care about how many different operation, how many
total number of operations can be done in a given N unit of time.</p>
<div class="keep-note primary"><p><strong>Hardware Idea #5:</strong></p>
<p>Use threads to hide high latency operations.</p>
</div>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/CS-267/image.8ojprpp3rg.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/CS-267/image.4n7qdc2eab.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<p>https://crd.lbl.gov/assets/Uploads/cug19-roofline-final.pdf</p>
<h2 id="programming-gpus">Programming GPUs</h2>
<p>Running GPU Code (Kernel)</p>
<ul>
<li><p>Allocate memory on GPU</p></li>
<li><p>Copy data to GPU</p></li>
<li><p>Execute GPU program</p></li>
<li><p>Wait to complete</p></li>
<li><p>Copy results back to CPU</p></li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Example: Vector Addition (GPU Serial)</span></span><br><span class="line"><span class="type">float</span>* x = <span class="keyword">new</span> <span class="type">float</span>[N];</span><br><span class="line"><span class="type">float</span>* y = <span class="keyword">new</span> <span class="type">float</span>[N];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> size = N * <span class="built_in">sizeof</span>(<span class="type">float</span>);</span><br><span class="line"><span class="type">float</span> *d_x, *d_y; <span class="comment">// device copies of x, y</span></span><br><span class="line"><span class="built_in">cudaMalloc</span>((<span class="type">void</span>**)&amp;d_x, size);</span><br><span class="line"><span class="built_in">cudaMalloc</span>((<span class="type">void</span>**)&amp;d_y, size);</span><br><span class="line"></span><br><span class="line"><span class="built_in">cudaMemcpy</span>(d_x, x, size, cudaMemcpyHostToDevice);</span><br><span class="line"><span class="built_in">cudaMemcpy</span>(d_y, y, size, cudaMemcpyHostToDevice);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run kernel on GPU</span></span><br><span class="line"><span class="type">int</span> blockSize = <span class="number">256</span>;</span><br><span class="line"><span class="type">int</span> numBlocks = (N + blockSize - <span class="number">1</span>) / blockSize;</span><br><span class="line">add&lt;&lt;&lt;numBlocks, blockSize&gt;&gt;&gt;(N, d_x, d_y);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Copy result back to host</span></span><br><span class="line"><span class="built_in">cudaMemcpy</span>(y, d_y, size, cudaMemcpyDeviceToHost);</span><br><span class="line"><span class="comment">// Free memory</span></span><br><span class="line"><span class="built_in">cudaFree</span>(d_x); <span class="built_in">cudaFree</span>(d_y);</span><br><span class="line"><span class="keyword">delete</span>[] x; <span class="keyword">delete</span>[] y;</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GPU function to add two vectors</span></span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> n, <span class="type">float</span>* x, <span class="type">float</span>* y)</span> </span>{</span><br><span class="line">	<span class="type">int</span> index = blockDim.x * blockIdx.x + threadIdx.x;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (index &lt; n) {</span><br><span class="line">		y[i] = x[i] + y[i];</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><strong>Monolithic kernel</strong>: assumes we have enough threads to
more than cover the array size. There are hardware limits on numBlocks
too (but they are high)</p>
<p>The only problem here is, it creates all these threads and keeps them
alive. And that actually has certain costs in terms of scheduling. It
actually stops you from optimizing for those variables.</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Run kernel on GPU</span></span><br><span class="line"><span class="type">int</span> blockSize = <span class="number">256</span>;</span><br><span class="line"><span class="type">int</span> numSMs;</span><br><span class="line"><span class="built_in">cudaDeviceGetAttribute</span>(&amp;numSMs, cudaDevAttrMultiProcessorCount, devId);</span><br><span class="line">add&lt;&lt;&lt;<span class="number">32</span>*numSMs, blockSize&gt;&gt;&gt;(N, x, y);</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GPU function to add two vectors</span></span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> n, <span class="type">float</span>* x, <span class="type">float</span>* y)</span> </span>{</span><br><span class="line">	<span class="type">int</span> index = blockDim.x * blockIdx.x + threadIdx.x;</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> stride = blockDim.x * gridDim.x;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = index; i &lt; n; i += stride)</span><br><span class="line">		y[i] = x[i] + y[i];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><strong>Grid-stride loops</strong>: you can now limit the number of
blocks to tune performance</p>
<p>When you limit the number of blocks in your grid, threads are reused
for multiple computations, amortizes thread creation/destruction.</p>
<p>Grid is a collection of threads. Threads in a grid execute a kernel
function and are divided into thread blocks.</p>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/CS-267/image.4qrcb31i9s.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<p><code>gridDim</code>: the total number of blocks launched by this
kernel invocation, as declared when instantiating the kernel.</p>
<blockquote>
<p><strong>Why I'm limiting the number of threads within a block to
256?</strong></p>
<p>The deeper answer to this question is registers. It's a fixed
resource that is very valuable. The more threads you launch, the more
threads are competing for the register file.</p>
<p>You might want to tune these variables so that your input fits,
especially the ones that you repeatedly access, fits into registers much
as possible.</p>
</blockquote>
<h3 id="grids-and-thread-blocks">Grids and Thread Blocks</h3>
<p>A 2D Grid of 2D Blocks</p>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/CS-267/image.4jo4fnrqms.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<p><code>int blockId = blockIdx.x + blockIdx.y * gridDim.x;</code></p>
<p><code>int threadId = blockId * (blockDim.x * blockDim.y) + (threadIdx.y * blockDim.x) + threadIdx.x;</code></p>
<h2 id="sharing-and-synchronization">Sharing and Synchronization</h2>
<h3 id="memory-types-on-nvidia">Memory types on NVIDIA</h3>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/CS-267/image.67xhcusbic.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<ul>
<li><p><strong>Registers</strong> per thread</p></li>
<li><p><strong>Local</strong> cached memory per thread</p></li>
<li><p><strong>Shared</strong> memory (shared in block)</p></li>
<li><p><strong>Global</strong> device level shared</p></li>
<li><p><strong>Constant</strong> cache shared by threads</p></li>
<li><p><strong>Texture</strong> cache shared by all block</p></li>
</ul>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/CS-267/image.4n7qddzyx8.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<p>Use both blocks and threads -- Why?</p>
<p><code>kernel_call&lt;&lt;&lt;blocks, threads&gt;&gt;&gt;</code></p>
<p><strong>Limit on maximum number of threads/block</strong></p>
<ul>
<li>Threads alone won't work for large arrays</li>
</ul>
<p><strong>Fast shared memory only between threads</strong></p>
<ul>
<li>Blocks alone are slower</li>
</ul>
<p>Stencil Kernel </p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">stencil_1d</span><span class="params">(<span class="type">int</span> *in, <span class="type">int</span> *out)</span> </span>{</span><br><span class="line">	__shared__ <span class="type">int</span> temp[BLOCK_SIZE + <span class="number">2</span> * RADIUS];</span><br><span class="line">	<span class="type">int</span> gindex = threadIdx.x + blockIdx.x * blockDim.x;</span><br><span class="line">	<span class="type">int</span> lindex = threadIdx.x + RADIUS;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Read input elements into shared memory</span></span><br><span class="line">	temp[lindex] = in[gindex];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (threadIdx.x &lt; RADIUS) { <span class="comment">// fill in halos</span></span><br><span class="line">		temp[lindex - RADIUS] = in[gindex - RADIUS];</span><br><span class="line">		temp[lindex + BLOCK_SIZE] = in[gindex + BLOCK_SIZE]</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Apply the stencil</span></span><br><span class="line">	<span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> offet = -RADIUS; offset &lt;= RADIUS; offset++) {</span><br><span class="line">		result += temp[lindex + offset];</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Store the result</span></span><br><span class="line">	out[gindex] = result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Problem: Race Condition! we need thread synchronization</p>
<ul>
<li>Synchronizes all threads within a block</li>
</ul>
<p><code>void __syncthreads();</code></p>
<ul>
<li><p>Used to prevent RAW / WAR / WAW hazards</p></li>
<li><p>All threads in the block must reach the barrier</p></li>
<li><p>If used inside a conditional, the condition must be uniform
across the block.</p></li>
</ul>
<blockquote>
<p>Note: An important things about all the barriers, is if you are
trying to synchronize with a barrier, some group of threads, processors,
anything, you have to make sure that the sync threads or barrier is
called by <strong>all the threads or processes.</strong></p>
</blockquote>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__global__ <span class="type">void</span> stencil<span class="number">-1</span>d(<span class="type">int</span> *in, <span class="type">int</span> *out) {</span><br><span class="line">	... </span><br><span class="line">	<span class="comment">// setup temp halos...</span></span><br><span class="line">	<span class="comment">// Synchronize (ensure all the data is available)</span></span><br><span class="line">	__syncthreads();</span><br><span class="line">	<span class="comment">// Apply the stencil</span></span><br><span class="line">	<span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> offset = -RADIUS; offset &lt;= RADIUS; offset++) {</span><br><span class="line">		result += temp[lindex + offset];</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">// Store the result</span></span><br><span class="line">	out[gindex] = result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><p>Threads within a block may synchronize with barriers</p></li>
<li><p>Blocks coordinate via atomic memory operations</p></li>
<li><p>Implicit barrier between kernels</p></li>
</ul>
<h3 id="blocks-must-be-independent">Blocks must be independent</h3>
<p><strong>Any possible interleaving of blocks should be
valid</strong></p>
<ul>
<li><p>presumed to run to completion without pre-emption (not fairly
scheduled)</p></li>
<li><p>can run in any order</p></li>
<li><p>can run concurrently OR sequentially</p></li>
</ul>
<p><strong>Blocks may coordinate but not synchronize</strong></p>
<ul>
<li><p>shared queue pointer: <strong>OK</strong></p></li>
<li><p>shared lock: <strong>BAD</strong> ... can easily
deadlock</p></li>
</ul>
<p><strong>Independence requirement gives scalability</strong></p>
<h3 id="mapping-cuda-to-nvidia-gpus">Mapping CUDA to NVIDIA GPUs</h3>
<p>Threads:</p>
<ul>
<li>Each thread is a SIMD lane (ALU)</li>
</ul>
<p>Warps:</p>
<ul>
<li><p>A warp executed as a logical SIMD instruction (sort of)</p></li>
<li><p>Warp width is 32 elements: <strong>LOGICAL</strong> SIMD
width</p></li>
<li><p>(Warp-level programming also possible)</p></li>
</ul>
<p>Thread blocks:</p>
<ul>
<li><p>Each thread block is scheduled onto an SM</p></li>
<li><p>Peak efficiency requires multiple thread blocks per
processor</p></li>
</ul>
<p>Kernel</p>
<ul>
<li>Executes on a GPU (there is also multi-GPU programming)</li>
</ul>
<h3 id="memory-coalescing">Memory coalescing</h3>
<p>When you're fetching data from global memory to somewhere, for
execution, You don't even need to copy it from shared memory. You can be
fetching it for execution to registers.</p>
<p>Successive 4W bytes (W: warp size, 4: size of single word in bytes)
memory can be accessed by a warp (W consecutive threads) in a single
transaction.</p>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/CS-267/image.26lhyivgg6.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>
<p>The following conditions may result in <strong>uncoalesced</strong>
load, i.e., memory access becomes <strong>serialized</strong>:</p>
<ul>
<li><p>memory is not <strong>sequential</strong></p></li>
<li><p>memory access is <strong>sparse</strong> (some addressed
skipped)</p></li>
<li><p><strong>misaligned</strong> memory access</p></li>
</ul>
<figure>
<img lazyload="" alt="image" data-src="https://github.com/amor-mio-de-mi-vida/picx-images-hosting/raw/master/CS-267/image.8ada0z2tu3.webp">
<figcaption aria-hidden="true">image</figcaption>
</figure>

                    
                </div>

                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                Introduction to Graphics Processing Unit (GPUs)
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                2024/11/11/course-CS267-7-Introduction-to-Graphics-Processing-Unit-GPUs/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    Author
                </div>
                <div class="content">amor mío de mi vida</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    Published
                </div>
                <div class="content">2024-11-11 13:33</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    License
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="Copy copyright info" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/course/">course</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip" data-tooltip-content="Share to QQ">
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img" data-tooltip-content="Share to WeChat" data-tooltip-img-tip="Scan by WeChat" data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;">
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip" data-tooltip-content="Share to WeiBo">
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev" rel="prev" href="/2024/11/11/paper-survey-Survey-on-Large-Scale-Neural-Network-Training/" title="Survey on Large Scale Neural Network Training">
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">Survey on Large Scale Neural Network Training</span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next" rel="next" href="/2024/11/10/course-CS267-6-More-on-Communication-optimal-Matmul-and-beyond/" title="More on Communication-optimal Matmul (and beyond)">
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">More on Communication-optimal Matmul (and beyond)</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#summary"><span class="nav-text">Summary</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gpu"><span class="nav-text">GPU</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-a-gpu"><span class="nav-text">What is a GPU?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-about-branches"><span class="nav-text">What about Branches?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stalls"><span class="nav-text">Stalls</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#programming-gpus"><span class="nav-text">Programming GPUs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#grids-and-thread-blocks"><span class="nav-text">Grids and Thread Blocks</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sharing-and-synchronization"><span class="nav-text">Sharing and Synchronization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#memory-types-on-nvidia"><span class="nav-text">Memory types on NVIDIA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#blocks-must-be-independent"><span class="nav-text">Blocks must be independent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mapping-cuda-to-nvidia-gpus"><span class="nav-text">Mapping CUDA to NVIDIA GPUs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#memory-coalescing"><span class="nav-text">Memory coalescing</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
        ©&nbsp;<span>2020</span>&nbsp;-&nbsp;2024
        
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">amor mío de mi vida</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&amp;&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    
        <div class="count-info info-item">
            

            
                <span class="count-item border-box uv">
                    <span class="item-type border-box">Unique Visitor</span>
                    <span class="item-value border-box uv" id="busuanzi_value_site_uv"></span>
                </span>
            

            
                <span class="count-item border-box pv">
                    <span class="item-type border-box">Page View</span>
                    <span class="item-value border-box pv" id="busuanzi_value_site_pv"></span>
                </span>
            
        </div>
    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#summary"><span class="nav-text">Summary</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gpu"><span class="nav-text">GPU</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-a-gpu"><span class="nav-text">What is a GPU?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-about-branches"><span class="nav-text">What about Branches?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stalls"><span class="nav-text">Stalls</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#programming-gpus"><span class="nav-text">Programming GPUs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#grids-and-thread-blocks"><span class="nav-text">Grids and Thread Blocks</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sharing-and-synchronization"><span class="nav-text">Sharing and Synchronization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#memory-types-on-nvidia"><span class="nav-text">Memory types on NVIDIA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#blocks-must-be-independent"><span class="nav-text">Blocks must be independent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mapping-cuda-to-nvidia-gpus"><span class="nav-text">Mapping CUDA to NVIDIA GPUs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#memory-coalescing"><span class="nav-text">Memory coalescing</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local search -->

    
<script src="/js/local-search.js"></script>



<!-- lazyload -->

    
<script src="/js/lazyload.js"></script>



<div class="pjax">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        
            
<script src="/js/post/toc.js"></script>

        

        <!-- copyright-info -->
        
            
<script src="/js/post/copyright-info.js"></script>

        

        <!-- share -->
        
            
<script src="/js/post/share.js"></script>

        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->

    
<script src="//cdn.jsdelivr.net/npm/mermaid@10.5.0/dist/mermaid.min.js"></script>

    <script data-pjax="">
      if (window.mermaid) {
        mermaid.init()
      }
    </script>






<!-- pjax -->

    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart()
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd()
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'))
            KEEP.initExecute()
        });
    });
</script>






<script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>